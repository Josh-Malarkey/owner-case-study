version: 2

models:
  - name: fct_lead_funnel
    description: >
      One row per lead representing the full prospect journey from lead
      creation through opportunity close. Core fact table for funnel analysis,
      activity efficiency, and lead-level LTV estimation.
    columns:
      - name: lead_id
        description: Primary key — one row per lead.
        tests:
          - unique
          - not_null
      - name: channel
        tests:
          - accepted_values:
              values: ['inbound', 'outbound']
      - name: current_funnel_stage
        tests:
          - accepted_values:
              values:
                - new_lead
                - contacted
                - meeting_booked
                - opportunity_open
                - closed_won
                - closed_lost
      - name: estimated_ltv_24mo
        description: >
          24-month LTV estimate for closed-won deals:
          ($500 subscription + 5% of predicted_monthly_sales) * 24.

  - name: fct_account_ltv
    description: >
      Account-level lifetime value estimates for closed-won accounts.
      Aggregates won deals, revenue components, and LTV projections.
      Grain: one row per account_id per channel.
    columns:
      - name: account_id
        description: Primary key — one row per account per channel.
        tests:
          - not_null
      - name: channel
        tests:
          - accepted_values:
              values: ['inbound', 'outbound']
      - name: total_estimated_ltv_24mo
        description: >
          Sum of 24-month LTV estimates across all won deals for this account.

  - name: fct_channel_economics
    description: >
      Monthly channel-level acquisition costs, conversion rates, and
      velocity metrics. CAC is computed as total cost / closed-won deals.
      Grain: month x channel.
    columns:
      - name: lead_created_month
        tests:
          - not_null
      - name: channel
        tests:
          - accepted_values:
              values: ['inbound', 'outbound']

  - name: fct_funnel_stage_conversion
    description: >
      Stage-to-stage conversion rates and velocity by cohort month
      and channel. Supports funnel drop-off and time-in-stage analysis.
    columns:
      - name: lead_created_month
        tests:
          - not_null
      - name: channel
        tests:
          - accepted_values:
              values: ['inbound', 'outbound']

  - name: fct_loss_reason_analysis
    description: >
      Aggregated loss reasons for closed-lost opportunities by month
      and channel. Identifies top reasons deals are lost.

  - name: fct_activity_efficiency
    description: >
      Activity volume and efficiency metrics (calls, texts, emails)
      by channel, outcome, and cohort month. Answers "how many touches
      does it take to close a deal?"

  - name: fct_unit_economics
    description: >
      Combines channel-level CAC from fct_channel_economics with
      account-level LTV from fct_account_ltv to compute CAC:LTV ratios
      and payback periods. Grain: month x channel.
    columns:
      - name: lead_created_month
        description: month the lead was created
        tests:
          - not_null
      - name: channel
        tests:
          - accepted_values:
              values: ['inbound', 'outbound']
      - name: ltv_to_cac_ratio
        description: >
          Average LTV per account divided by CAC. Values above 3 are
          generally considered strong.
      - name: payback_period_months
        description: >
          Months to recover CAC from average monthly revenue per account.
